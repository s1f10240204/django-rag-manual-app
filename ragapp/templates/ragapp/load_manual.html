{% extends 'ragapp/base.html' %}
{% block title %}マニュアルを読み込み{% endblock %}
{% block content %}
<div class="content-card load-card">
    {% if categories %}
        <h1>ManuAI</h1>
        <p class="text-secondary mb-4">製品名を直接入力するか、カテゴリから探してください。</p>
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                <input type="text" name="product_name" class="form-control" placeholder="ここに製品名を入力..." required>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-gradient" id="testbtn">チャットを開始</button>
            </div>
        </form>
        <p id = "text"></p>
        <div class="text-secondary my-3">— または —</div>
        <div class="category-grid">
            {% for category in categories %}
                <a href="?category={{ category.slug }}" class="category-card">{{ category.name }}</a>
            {% endfor %}
        </div>
    {% elif suggested_products %}
        <h1>{{ current_category_name }}</h1>
        <p class="text-secondary mb-4">人気の製品を選択するか、型番を直接入力してください。</p>
        <form method="post" id="product-form">
            {% csrf_token %}
            <div class="mb-3"><input type="text" name="product_name" id="product-input" class="form-control" placeholder="ここに製品名を入力..." required></div>
            <div class="d-grid"><button type="submit" class="btn btn-gradient">チャットを開始</button></div>
        </form>
        <div class="mt-4">
            <p class="text-secondary small">候補から選択:</p>
            <div id="suggestions-container">{% for p in suggested_products %}<button class="btn btn-light m-1" data-product-name="{{ p.name }}">{{ p.icon }} {{ p.name }}</button>{% endfor %}</div>
        </div>
        <a href="{% url 'load_manual' %}" class="back-link">← カテゴリ選択に戻る</a>
    {% endif %}
    {% if error %}<div class="alert alert-danger mt-3">{{ error }}</div>{% endif %}
</div>
<script>
    function text_change(){
        text = document.getElementById("text")
        text.textContent = "しばらくお待ちください。"
    }
document.addEventListener('DOMContentLoaded', () => {
    const suggestionsContainer = document.getElementById('suggestions-container');
    if (suggestionsContainer) {
        const productInput = document.getElementById('product-input');
        const productForm = document.getElementById('product-form');
        suggestionsContainer.addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                productInput.value = event.target.dataset.productName;
                productForm.submit();
            }
        });
    }
    btn = document.getElementById("testbtn")
    btn.addEventListener('click', text_change)
});
</script>
<style>
.category-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; }
.category-card { background: #F8F9FA; border: 1px solid var(--border-color); color: var(--text-primary); padding: 1.5rem 1rem; border-radius: 12px; text-decoration: none; transition: all 0.2s ease; font-size: 0.9rem; }
.category-card:hover { border-color: #ddd; background: #fff; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
.back-link { display: block; margin-top: 1.5rem; color: var(--text-secondary); text-decoration: none; }
.back-link:hover { color: var(--text-primary); }
</style>
{% endblock %}